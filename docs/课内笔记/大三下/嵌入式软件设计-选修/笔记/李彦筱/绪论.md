# 嵌入式软件设计-概述

嵌入式系统应用是计算机应用的一个分支。嵌入式系统和物联网高度相关。

> 物联网由应用层、网络层和感知层三层构成（顺序为从上到下）。其中，网络层和感知层大部分由嵌入式系统实现。

课程内容：介绍嵌入式系统的发展趋势，设计方法和编程技术；讲课与练习相结合。

## 嵌入式系统的应用领域

嵌入式系统广泛的应用在航空航天、军事国防、工业领域和消费电子领域中。

比如，在汽车中，嵌入式系统可以用于车门控制、尾灯控制、发动机控制和灯光控制。机器人上也需要嵌入式系统实现电机控制和 PID 控制等内容。工业控制中，嵌入式设备可以用于工业硬件、自动化流水线的构建。

航空航天：飞行器、卫星/月球车之类的控制大多使用嵌入式系统。

军事电子：导弹采用嵌入式系统做控制

网络设备：交换机、路由器也属于嵌入式设备

消费电子：智能家电（洗衣机）、部分电动玩具（小飞机、遥控车）都属于嵌入式系统

> 似乎手机和智能手表也可以算做嵌入式系统

嵌入式系统常用于移动互联网和物联网领域。

应用示例：共享单车

共享单车需要实现可骑行、远程开锁、定位等功能。嵌入式系统在共享单车中的作用如下：

- 控制电子锁正确开锁
- 通过无线网络（4G/5G，一般就是物联网）连接互联网，接收服务器下发的开锁/关锁指令
- 通过 GPS 或者北斗进行定位

## 嵌入式系统的定义

**IEEE 的定义：**

嵌入式系统是“用于控制、监视或者辅助操作机器与设备的装置”。

此定义是从应用上考虑的，即强调嵌入式系统的主要用途。嵌入式系统是软件和硬件的结合体，软件代码与硬件结构、接口高度相关。

**一般定义：**

以应用为中心，以计算机技术为基础，软件硬件可裁剪，功能、可靠性、成本、体积、功耗严格要求的专用计算机系统。

> 以应用为中心：即嵌入式系统是面向应用的，为了解决实际问题而设计的
>
> 可裁剪：复杂性可以降低，因此可以限制资源消耗
>
> 专用：用于完成特定的工作，难以移植

简单定义：嵌入到对象体系中的专用计算机系统。

三个要素：**嵌入性**、**专用性**、**计算机系统**。

专用性：由于硬件模块限制，一般只能做特定的一件事，不像电脑可以编写多种程序。一旦完成硬件/软件的设计，就很难修改，也很难移植同一个软件到不同硬件上。

## 嵌入式系统的特点

- 系统内核小：性能较差，不过占用空间也小，且成本较低

- 专用性强：嵌入式系统通常为特定的用途而设计，很难用于其他用途

- 系统精简：只包含与目标用途匹配的系统组件，因此较为精简

- 高实时性：有实时性要求，处理外部输入的速度较快

- 需要专门的开发工具和环境：需要适用于嵌入式系统的特殊工具和环境


总结：嵌入式系统具有如下八个特性：

1. 是专用的计算机系统
2. 对环境存在要求（电气、物理要求）
3. 必须满足对象系统控制要求
4. 集计算机技术与其他行业知识一体的系统
5. 具有较长的生命周期（运行时间要求长）
6. 软件固化（写死）在非易失的存储器中
7. 实时性要求高
8. 需要专用开发环境和开发工具进行设计

## 嵌入式系统的发展

### 发展的四个阶段

1. 8位/16位单片机为核心的初级嵌入式系统。大部分都没有机载的操作系统层。

   > 复习一下计组：位是指单次运算中可以接受的操作数的最大长度。绝大部分计算机的位长也等于地址总线和数据总线的宽度。

2. 以 32 位微控制器为基础的中级嵌入式系统。

3. 以嵌入式操作系统的出现为标记的中高级嵌入式系统。

   从这个阶段开始，单片机上出现了操作系统，可以自动调度你编写的程序。

   > 我很怀疑 51 单片机是不是根本就没操作系统啊）

4. 以 Internet（可联网）为标志的高级嵌入式系统

### 未来的发展趋势

- 联网成为必然趋势
- 支持小型电子设备实现低功耗，低成本
- 人机交互界面越来越精致（感觉和一般计算机看齐了）

## 嵌入式系统的组成结构

![image-20250622104314434](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBA2ia2SiE15QMjuwpFA_7yMejfY51AALGGwACnTzZVAnxfttSX4rSNgQ.png)

**软件层包含三层**：应用层、操作系统层和驱动层；下方其他层均为硬件层。

应用层：顶层，即自己编写的应用程序，通过调用系统层的 API 完成系统调用工作，不会直接接触硬件。

操作系统层：管理 CPU 时间分配，内存，外设等硬件资源，并对应用层提供接口以实现系统调用。和操作系统课程中讲的差不多。

驱动层：操作系统层利用驱动层与硬件进行具体交互。它在操作系统和硬件之间搭起了桥梁，帮助操作系统更加简单的使用硬件。

下方层均为硬件层。

SOC 是硬件的封装，包含处理器、内存、外设电路、内部接线等内容。

我们接触前三层（软件相关层）相比硬件层的次数明显更多。嵌入式的硬件是主要由 SOC，SOP 等内容组成的。

### 嵌入式系统的开发流程

![image-20250622104714806](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBBGia2Syrv4TyK5xUL3vm04BMJlKLAALHGwACnTzZVF1DXLQyK_TANgQ.png)

开发流程大致分为五个步骤：

1. 系统定义与需求分析：确定系统开发的总体目标；分析整个系统实现的可能性；提出系统开发可以采用的策略。

2. 系统设计初步说明文档：方案的设计阶段。根据上一部分系统分析的结果，形成系统的初步设计方案与描述文档

   第二行和第三行本质上可以视为同一个阶段

   在设计过程中，我们需要考虑多个内容，参考下方的竖向列。

3. 详细设计阶段：在这一阶段，需要进行右侧竖向列提到的多种设计过程

4. 调试阶段：编写软件后，写入硬件板卡后进行测试，查看它是否满足需求。完成硬件板卡的调试后，就可以将其烧录到实际的硬件中了

5. 调试成功后，开发结束，可以生产样机

### 微处理器的两个分支

> 计组中其实提到过这些内容

通用微处理器：

目的：高效、海量、通用的数据处理能力

路线：总线速度的无限提升/存储量的无限扩大（估计还有性能的无限提升）

缺点：由于计算能力要求高，功耗较高、体积较大

嵌入式微处理器：

目的：具有满足对象系统需求的性能、控制能力和控制可靠性

> 比如哈啰车上的嵌入式微处理器就需要可靠的控制锁。万一控制出现了问题，就需要等维修人员来修，非常麻烦。

路线：单芯片实现，种类多样

其他：低功耗，小体积，接口丰富，不过通用计算能力差

#### 通用微处理器的发展道路

从 Intel 8086 处理器开始，通用微处理器的性能进步极为迅速。

特点：

- 硬件上的高处理性能，大容量处理介质
- 软件上庞大且完善的操作系统
- 开发团队高度专业化
- 通常价格高，而且功耗大，发热比较严重

#### 嵌入式微处理器的发展道路

嵌入式微处理器独立发展的标志为 Intel MCS-51 单片机的诞生，其字长长度经过了多次进度，不过性能提升并不算明显。

嵌入式处理器通常价格更便宜、功耗更低，但速度更慢。

特点：

- 硬件上的多样性（单芯片解决方案），可以根据具体领域要求配备多种外设
- 软件上精简、实时性高的操作系统
- 开发领域的广泛化（可以用于多种开发领域）

#### 二者的主要差异

速度：通用处理器通常远快于嵌入式处理器

> 一个例外就是专门用于科学计算的处理器：它们通常是嵌入式的，但在科学计算上速度比通用处理器更快。

体积：嵌入式处理器通常远小于通用处理器

功耗：嵌入式处理器功耗更低

外设接口电路：嵌入式处理器的外设电路更加丰富

### 嵌入式处理器分类

- 嵌入式微处理器（Microprocessor）：这种处理器只包含 CPU，为了嵌入式设备设计

- 嵌入式微控制器（MCU）：封装了 CPU，内存等部分元件，更加一体化

  相当于上者（嵌入式微处理器） + 外设 + 数模/模数转换+接口等内容封装成的

- 嵌入式 DSP（Digital Signal Processor）：用于处理数字信号的处理器

- SoC/SoPC：嵌入式片上系统，指集成在板上的嵌入式处理器

MCU：又称为单片机，是以微处理器为核心，在芯片内集成 ROM、RAM，总线、定时/计数器，watchdog，I/O，串口等各种必要设备和外设的芯片。

DSP 处理器：处理具体运算问题（傅立叶变换，数据滤波）等工作时速度较快。

SoC：嵌入式片上系统，在一个硅片上实现复杂的系统，方便生产。

SoPC：用可编程逻辑技术把整个系统放到一块硅片上，称作可编程片上系统。它的特点如下：

- 它是 SoC，即在单个芯片上实现系统的主要逻辑功能
- 它具备软硬件在系统可编程的能力，是一种可硬件编程的系统，

### 嵌入式处理器和其他处理器的比较

1. **CPU**(中央处理器):中央处理器，或称为 CPU，是计算机的大脑。 它是一块硅芯片，负责执行计算机程序中的指令。CPU 包含运算单元、 控制单元和缓存，通过时钟信号按照指令集执行各种操作。CPU 是计算机的核心组件，掌握着整个系统的运行节奏。其实 CPU 就是个计算和控制逻辑的单元。

2. **SoC**(片上系统):片上系统，或称为SoC，是一种将多个功能集成到 一个芯片上的设计。一个SoC通常包括CPU、内存、图形处理器、网络 控制器、输入输出接口等多个组件。SoC常见于移动设备(如智能手机 、平板电脑)和嵌入式系统，通过集成多个功能模块，提高了系统性 能，同时降低了功耗和成本。

3. **MCU**(微控制器):微控制器，或称为MCU，是一种包含CPU核心、 存储器和外设接口的微型计算机系统。与通用计算机不同，MCU通常用于嵌入式系统中，其设计旨在满足特定应用的需求

CPU: 专注于通用计算，广泛应用于个人计算机、服务器等。 SoC: 集成多个功能组件， 主要用于移动设备、嵌入式系统等。 MCU: 集成了计算、存储和通信功能，适用于嵌入式系统、物联网设备等。

CPU，SoC 和 MCU 三种处理器的优势与用途不同：

- 集成度:

  CPU: 通常作为独立的芯片存在。 SoC: 将多个功能集成在一个芯片上，提高了系统的紧凑性。 MCU: 与SoC 类似，集成度较高，但规模通常更小，适用于计算要求相对不高的场景

  > 手机主板就属于 SoC：手机的内存，处理器和显卡均集成在主板上，一般处理器和显卡是集成在同一芯片内的。

- 应用领域:

  CPU: 适用于各种通用计算任务。 SoC: 适用于移动设备（手机）、嵌入式系统、物联网等领域。 MCU: 适用于嵌入式系统、物联网、自动控制等特定领域。

- 功耗和性能:

  CPU: 注重性能，功耗相对较高。 SoC: 追求平衡，兼顾性能和功耗。 MCU: 低功耗是其主要特点，性能相对较低。

设备举例：

SoC：高通骁龙系列处理器，苹果 A 系列/M 系列处理器、三星系列处理器、联发科天玑系列处理器，树莓派

MCU：Microship PIC；STM32；

### 嵌入式外围接口

嵌入式设备常常包含如下设备接口：

> 由于嵌入式设备是高度可裁剪的，有的嵌入式系统可能不包含下方的一些接口

存储器：RAM 和 ROM

> 目前使用的 ROM 大部分都是可改写的，毕竟你也不希望你的单片机烧完一次代码就没法再改了吧

输入输出设备：机械式输入输出设备（鼠标、键盘），触控输入设备（触摸屏）、显示器等设备

通信接口：嵌入式设备和其他设备传输的通道，比如串口、USB 口

设备扩展接口：扩展卡接口

电源接口

## 嵌入式软件组成结构

> 其实第五节的开头已经提到过这个分层了

嵌入式软件可以分为四层，从下而上的列出，如下：

> 这里的分层和之前提到的不太相同，驱动层改名为板级支持包层，多了一个 API 层

- 板级支持包层（相当于驱动层）BSP

  提供访问底层硬件的支持，即操作系统和硬件层的交互。

- 实时操作系统 RTOS 层

- 应用程序层接口 API 

- 应用程序层

![image-20250423194757616](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBBWia2TAsFmKDMJ-MEXhFohwTTWNoAALIGwACnTzZVBf8SJEPN_F7NgQ.png)

> BSP 主要用于启动时的初始化、驱动程序访问硬件的中介

操作系统是应用软件的基础和平台，大部分为**实时**操作系统

> 能够在指定或者确定的时间内完成系统功能和对外部或 内部、同步或异步事件做出响应

### 通用计算机与嵌入式系统的对比

| 特征       | 通用计算机                                                   | 嵌入式系统                                                   |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 形式和类型 | **“**看得见”的计算机<br />按体系结构、运算速度、结构规模  等因素分为大、中、小型机和微机 | **“**看不见”的计算机<br />  形式多样、应用领域广泛、一般按应用分类 |
| 组成       | 通用处理器、标准总线和外设 软硬件相对独立                    | 嵌入式微处理器，总线和外部接口多集成在处理器内部             |
| 开发方式   | 开发平台、运行平台均为通用计算机                             | 交叉开发方式、开发平台为通用计算机，运行平台为嵌入式系统     |
| 二次开发性 | 应用程序可重新编制                                           | 一般不能再编程                                               |
| 发展目标   | 变为功能计算机，普遍进入社会                                 | 变为专用计算机，实现普适计算                                 |

> 看得见和看不见大概是指“我们有没有意识到它存在于我们身边”。比如，我们在使用洗衣机时，不会想到其内部包含一个嵌入式计算机吧。

## 嵌入式系统开发流程

开发特点：需要一个交叉编译和调试环境（即在宿主机上编译嵌入式架构的程序（交叉编译），编译完成后需要下载到嵌入式机器上运行（需要与宿主机连接调试））

系统设计的基本原则：**物尽其用**

面临的问题：**微处理器以及操作系统的选择**，开发工具的选择。

1. 嵌入式系统需求分析

   分析嵌入式系统需要实现的功能，包含功能需求和非功能需求

2. 嵌入式体系结构设计

   思考嵌入式系统如何实现上方分析得到的功能需求和非功能需求

3. 嵌入式硬软件及执行机构设计

   软硬件设计有相互融合的趋势：硬件设计软件化、软件设计硬件化

4. 嵌入式系统集成

5. 嵌入式系统测试

![image-20250624133745605](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBBmia2TPc9EmmU6BR7NthO0oaWKdlAALJGwACnTzZVBqhJmaEkhThNgQ.png)

![image-20250624133754102](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBB2ia2TZcPdGwaGT6xtZFTH96YeZnAALKGwACnTzZVBCeZOnYmWaGNgQ.png)

![image-20250624133802152](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBCGia2TngkVFkr1kly6fJ9g8FSKtsAALLGwACnTzZVL6bS0CHC5WANgQ.png)

![image-20250624133811028](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBCWia2T1yUqK0XOzaEt8QzwNzpW13AALMGwACnTzZVIzusRzK3iuENgQ.png)

![image-20250624133821529](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAIBCmia2UD9kktvvjQjZh92VAOtQTDiAALNGwACnTzZVJw0gpdiuWFQNgQ.png)
