# 第二章作业

> 作业为 2024-2025 学年老师在思源学堂上布置的内容，仅供核对答案参考，请不要直接抄袭。

1. 什么是 CISC 和 RISC，请简述二者的特点

   CISC 是指复杂指令集计算机，RISC 是指精简指令集计算机。

   CISC 追求指令集的复杂化，即追求一条指令能够完成更多的工作。CISC 机的指令集数量和每条指令的复杂程序都比较大。

   RISC 体系结构指令数量较少、且指令较为简单（指令格式和长度固定），大部分指令可以在单个周期内完成；此外，RISC 结构要求通过独立的 LOAD/STORE 指令访问内存，不支持在指令中通过内存寻址实现隐式访问内存。RISC 结构还通过多个通用寄存器存储调用栈的局部变量，减少函数调用花费的参数传递时间。

2. 对于程序 A 调用 B、B 调用 C 的情况，请给出其调用过程和实现机制。如何实现子程序从 C 返回 B，从 B 返回 A 的过程？

   A 调用 B：将下一条指令的地址存入 LR 中，然后将 PC 设置为 B 程序的起始地址；

   B 调用 C：将当前 LR 的内容压入 R13 栈中，将下一条指令的地址存入 LR（并覆盖已有内容），将 PC 设置为 C 程序的起始地址。

   B 调用 C 的结束：`mov PC, LR` 将 LR 内容写回 PC，之后从 R13 栈中弹出栈顶，写入 LR 中，恢复 A 调用 B 时保存的 LR 内容。

   A 调用 B 的结束：`mov PC, LR` 将 LR 内容写回 PC，之后就可以继续执行 A 程序。

3. 如何在 ARM 状态和 Thumb 状态之间进行切换？

   可以通过 `BX` 指令进行切换。如果 `BX` 指令跳转目标的地址最低位为 0，表示切换到 ARM 状态；地址最低位为 1，表示切换到 Thumb 状态。

4. ARM 处理器发生中断时的处理过程是什么？异常中断有哪些模式？如何从异常中断中返回？

   处理过程包含以下步骤：

   1. **保存处理器状态**：将当前程序状态寄存器（CPSR）的值保存到目标异常模式下对应的备份程序状态寄存器（SPSR）中。
   2. **更新 CPSR**：处理器进入相应的异常模式，并根据需要更新 CPSR 的状态位（例如，禁止新的中断，切换到 ARM 状态）。
   3. **保存返回地址**：将下一条指令的地址存入目标异常模式下的链接寄存器（LR，即 R14）中。这个地址通常是 `PC+4` 或 `PC+8`（取决于异常类型），确保异常处理结束后能返回到正确的位置。
   4. **跳转到异常向量**：强制将程序计数器（PC）设置为该异常对应的向量地址，从该地址开始执行异常处理程序。

   异常中断的模式包含：FIQ（快中断），IRQ（中断），SVC（管理模式，用于处理复位和系统调用）、中止和未定义五个模式。

   返回过程包含两步：

   1. **恢复 PC**：将 LR 寄存器中的值（可能需要经过偏移量调整）加载到 PC 寄存器，以返回到被中断的程序。
   2. **恢复 CPSR**：同时，将 SPSR 中保存的处理器状态恢复到 CPSR 中。

5. 什么是小端存储和大端存储？一个字的数据 0x89ABCDEF，存放在 0x0C100000~0x0C100003 区域，分别说明采用小端 模式存储和大端模式存储时，上述 4 个存储单元所存的数据。

   小端存储是指将一个字内低位的数据存储在低位的存储空间；大端存储是指将一个字内低位的数据存储在高位的存储空间。

   小端存储的结果如下：

   0x0C100000: 0xEF；0x0C100001: 0xCD；0x0C100002：0xAB；0x0C100003：0x89

   大端存储的结果如下：

   0x0C100000: 0x89；0x0C100001: 0xAB；0x0C100002：0xCD；0x0C100003：0xEF

6. 对于三级流水线，请回答当前正处于取址、译码和执行阶段的指令内存地址分别是什么，并解释原因？

   对于早期的 ARM 处理器（如 ARM7）采用的三级流水线，PC 始终指向“正在取指”的指令地址。因此：

   - **执行阶段**：指令地址为 `PC - 8`
   - **译码阶段**：指令地址为 `PC - 4`
   - **取指阶段**：指令地址为 `PC`

   原因是，当一条指令正在执行时，流水线中的下一条指令正在译码，再下一条指令正在被取指。ARM 指令长度为 4 字节，PC 值等于当前取指指令的地址。因此，正在译码的指令是上一条被取指的指令，其地址为 `PC-4`；正在执行的指令是上上条被取指的指令，其地址为 `PC-8`。

7. 哈佛结构和冯诺依曼结构有什么特点和区别？

   哈佛结构将指令和数据分开存储和传输，即有不同的指令/数据存储器，采用两条独立的总线

   冯诺依曼结构将指令和数据混合存储和传输，共用一个存储器与传输总线

   哈佛结构电路更复杂、成本更高，但不会出现指令-数据传输冲突的问题；冯诺依曼架构实现较为简单，但会出现指令-数据传输冲突的问题。

8. 寄存器 R0-R15 各有什么功能？R13-R15 寄存器，一般用于实现什么功能？

   R0-R12 为通用寄存器，可以用于存储任意数据。在 FIQ 模式下，R8-R12 有独立的备份寄存器，以实现快速中断处理。

   R13 通常用作**栈指针寄存器（SP）**，用于管理堆栈。在不同的处理器模式下，R13 有其独立的备份寄存器，指向该模式专属的栈空间。

   R14 被用作**链接寄存器（LR）**，主要用于存储子程序的返回地址。在异常发生时，它也用于保存返回地址。与 R13 类似，它在不同模式下也有独立的备份。

   R15 是**程序计数器（PC）**，它存放着当前正在取指的指令的地址。直接修改 PC 的值可以改变程序的执行流程。

9. 理解并说明程序状态寄存器 CPSR 各位所表达的信息。

   CPSR 分为四个条件码位，保留位和控制位。其中：

   N（负标志位）：上一条指令计算结果为负：1；正/0：0

   Z（零标志位）：上一条指令计算结果为 0：1；其他非零数字：0

   C（进位标志）：加法出现进位：1；正常完成：0；

   减法出现借位：0；正常完成：1

   其他情况：保留之前的值不变

   V（溢出标志）：加减法指令结果溢出：1；没有溢出：0；其他指令：保留之前的值不变

   I 控制位：IRQ 中断禁止标志，0:允许 IRQ 中断；1: 禁止

   F：FIQ 中断禁止标志，0：允许；1:禁止

   T：工作状态位，1:Thumb，0:ARM

   M4M3M2M1M0：五位的组合用于表示当前处理器模式：

   10000:用户模式；10001:FIQ；10010:IRQ；10011:管理模式；10111:中止模式；11011:未定义模式；11111:系统模式。